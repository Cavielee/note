# 状态保留

使用 Http 协议进行客户端与服务端通信，由于 Http 协议无状态特性。因此每一次进行通信请求都是无关联的。

而在实际场景中，往往需要多次通信请求需要保留一定的状态，如登陆状态，一旦登陆后，每一请求访问都应该能够保留登陆状态，而不是重新进行登陆。

因此需要一种机制去保留状态。



## 会话 Session

客户端一旦和服务端建立连接后，会生成会话 Session，该 Session 会有一个唯一的 Id，客户端只要在请求访问时带上该 SessionId，服务端就会找到对应的 Session 会话。此时只需要将要保留的状态数据放在 Session 即可。



## Cookie

Cookie 是一种将状态数据存储在客户端的形式。

如上述服务端 Session 使用，可以通过将 SessionId 存储在客户端的 Cookie 中，客户端访问服务端时，只需将 Cookie 信息带上即可。



## Session 和 Cookie 区别

1. 实际上数据都可以存储在客户端 Cookie 中，但为了确保数据的安全性（防止数据被窃取或者串改），因此一些敏感数据需要存储在服务端 Session 中。
2. Cookie 数据越多，意味着每次请求附带的数据越多，请求体积大小越大，从而导致网络更大消耗。
3. 客户端可以选择屏蔽 Cookie，此时可以通过将状态数据存储在 url 上，但该方案是明文传输，不安全的。



# 分布式会话

在单应用架构中，我们将状态保存在本地中，而在分布式架构中，显然该方案是不可行，因为多个请求可能落在集群的不同节点中。

解决方案：

1. 状态还是保存在本地，但是会 Session 同步到集群中的各个节点，从而保证任意访问集群中的节点时，Session 都是完整的。

   缺点：同步需要额外的消耗；每个节点都需要保存一份 Session 数据，显得冗余；由于网络存在一定的延迟，因此节点 Session 的数据不一定是强一致。

2. Session 数据集中存储在第三方中间件（如 Redis）。并且第三方中间件也可以做集群（防止单点故障导致不可用）。

3. 将会话数据存储在客户端（Cookie）。

   缺点：如上述所说，不安全和增加网络消耗。

