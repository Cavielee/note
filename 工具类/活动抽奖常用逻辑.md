# 什么是抽奖

抽奖实际上就是在一堆奖品中，根据特定的规则抽取其中一个奖品。



# 影响抽奖的因素

在实际需求中有很多种活动抽奖类型，不同的规则限制，会影响是否可以抽奖，是否中奖。下面举例常见的常见的规则限制：

## 参与人数限制

**情景1：前多少个用户才能有资格抽奖。**

分析：上述是抽奖的前置条件，每次抽奖都需要判断当前是第几个参与抽奖，如果超过上限值则没有资格参与抽奖。

解决方案：可以使用redis给抽奖活动设置一个限制值，然后每次进行参与抽奖前都对该值-1，并判断是否大于等于0，从而快速判断是否有资格参与抽奖。



**情景2：每多少个参与用户中抽中指定个数用户。**

分析：上述是中奖个数的条件。通过指定范围数值将参与用户划分成多个池子，并从每个池子中抽出中奖用户。



**情景3：参与人数大于指定值（即阈值），奖品才会加入抽取池中。**

分析：上述是筛选抽取奖品池的条件。当参与人数大于指定值时，就将奖品加入抽取池，从而控制价值高的奖品是否露出到抽取池中。

解决方案：抽奖时，需要判断当前参与人数是否满足奖品指定到的阈值，满足才把奖品加入到可抽取奖品列表中。



## 抽取次数限制

**情景1：用户抽取次数到达指定值时必出指定奖品（可以是同一个用户，或者所有用户）**

分析：可以指定当用户抽取到指定次数时，必定抽出指定奖品。



**情景2：用户抽取次数到达指定值时，指定奖品会加入抽取池（可以是同一个用户，或者所有用户）**

分析：可以指定当用户抽取到指定次数时，指定奖品会加入抽取池。



## 必出阈值范围（抽取次数）

**情景1：指定奖品会在某个抽取次数范围里必出一次**

分析：例如奖品必出阈值范围为[10,20]，则此时当抽取次数在[10,20]时，一定会抽中一次。

但此时会引申问题：`如何规避奖品只会出一次？`

解决上述问题可以在初始化时将该问题转换成在[10,20]范围里选一个数作为必出值并保存，这样就确保不会重复抽中。

但这种解决方法还会引申出新的问题：`每个用户都在指定值必出该奖品，而不是在[10,20]随机抽中`

解决上述问题可以在初始化时粒度可以细化到用户，即每个用户对该奖品在范围[10,20]中必出值都随机生成并保存，这样就确保每个用户抽中都是在这个指定阈值范围内随机。



## 权重

